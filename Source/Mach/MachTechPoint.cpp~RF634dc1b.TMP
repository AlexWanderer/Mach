#include "Mach.h"
#include "MachTechPoint.h"
#include "MachCharacter.h"


AMachTechPoint::AMachTechPoint(const class FPostConstructInitializeProperties& PCIP)
	: Super(PCIP)
{
	PrimaryActorTick.bCanEverTick = true;

	MaxUsers = 2;
	CaptureTime = 20.f;
	ResearchTime = 40.f;
	ResetTime = 10.f;
	Progress = 0.f;

	SphereComponent = PCIP.CreateDefaultSubobject<USphereComponent>(this, TEXT("SphereComponent"));
	SphereComponent->InitSphereRadius(250.0f);
	SphereComponent->OnComponentBeginOverlap.AddDynamic(this, &AMachTechPoint::OnBeginOverlap);
	SphereComponent->OnComponentEndOverlap.AddDynamic(this, &AMachTechPoint::OnEndOverlap);

	RootComponent = SphereComponent;
}

void AMachTechPoint::Tick(float DeltaSeconds)
{
	Super::Tick(DeltaSeconds);

	if (Role == ROLE_Authority && bInUse && Progress <= 100.f)
	{
		float Multiplier = (NumUsers < MaxUsers) ? NumUsers : MaxUsers;
		Progress += (DeltaSeconds / CaptureTime) * 100;

		UE_LOG(LogTemp, Warning, TEXT("Building this tech point, progress=%.2f"), Progress);
	}
}